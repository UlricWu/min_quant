name: Auto Release PR

on:
  push:
    branches:
      - develop
permissions: # â­ è§£å†³ 403 çš„å…³é”®ï¼
  contents: write
  pull-requests: write
jobs:
  create-release-pr:
    name: Create Release Pull Request
    runs-on: ubuntu-latest
    # é¢å¤–ä¿æŠ¤ï¼šç¡®ä¿ä¸ä¼šåœ¨ master æˆ–å…¶ä»–åˆ†æ”¯è§¦å‘æœ¬ job
    if: github.ref == 'refs/heads/develop'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Ensure we are on develop
        run: |
          git checkout develop
          echo "Current HEAD:"
          git log -1 --oneline

      # â­ å…³é”®ç‚¹ 1ï¼šç”¨ develop ç›´æŽ¥åˆ›å»º / è¦†ç›– release åˆ†æ”¯
      - name: Create/Reset release branch from develop
        run: |
          git checkout -B release/auto-release develop
          git push -f origin release/auto-release

      # â­ å…³é”®ç‚¹ 2ï¼šåªç”¨ create-pull-request åˆ›å»º/æ›´æ–° PRï¼Œä¸æ”¹ä»»ä½• commit
      - name: Create or update PR develop -> master
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          base: master
          branch: release/auto-release
          title: "Release: Next Version"
          body: |
            ## ðŸš€ Auto Release PR (develop â†’ master)

            This PR was generated automatically from the latest state of **develop**.

            All commits between `master` and `develop` will be included in this release.

            âœ… After review, merge this PR to trigger **semantic-release** on `master`.
          labels: |
            release
            automated
          draft: false


