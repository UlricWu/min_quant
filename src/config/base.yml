# ==================================================
# EXECUTION SEMANTICS (FROZEN)
#
# - `python -m src.cli train`
#     → ONLY reads `training`
#     → MUST NOT read `backtest`
#
# - `python -m src.cli backtest`
#     → ONLY reads `backtest`
#     → MUST NOT read `training`
#
# - `python -m src.cli experiment`
#     → reads `training` then `backtest`
# ==================================================

log:
  dir: "logs"
  rotation: "1 day"
  retention: "30 days"
  level: "DEBUG"

data:
  remote_dir: "level2"

model:
  train_days: 120
  valid_days: 20
  test_days: 20
  model_path: "models/"

pipeline:
  ftp_backend: "curl"
  max_worker: 4


# ==================================================
# Backtest System (unchanged)
# ==================================================
backtest:
  name: "rf_alpha_v1"
  level: l1
  replay: multi

  dates:
    - "2025-12-01"

  symbols:
    - "600004"
    - "600011"

  strategy:
    type: threshold
    model:
      spec:
        family: sgd
        task: regression
        version: v1
        artifact:
          run: minute_sgd_online_v1
          asof: latest
    params:
      threshold: -0.0005
      qty: 10

    feature:
      - l1_std_w20_abs_move
      - l1_z_w20_l0_amount

    signal_feature: l1_std_w20_abs_move
    threshold: 0.0


# ==================================================
# Training System (ONLINE / FINAL / FROZEN)
# ==================================================
training:
  name: "minute_sgd_online_v1"

  # ----------------------------------
  # Scheduler semantics
  # ----------------------------------
  start_date: 2025-11-03
  end_date: 2025-11-05
  warmup_days: 1

  # ----------------------------------
  # Model selection (REGRESSION)
  # ----------------------------------
  model_name: "sgd"
  model_version: "v1"
  task_type: "regression"

  # ❌ classification only fields REMOVED
  # classes: [0, 1]

  model_params:
    alpha: 0.0005
    l1_ratio: 0.0

  # ----------------------------------
  # Evaluation semantics
  # ----------------------------------
  evaluation_enabled: true
  evaluation_metrics:
    - ic        # Rank IC（核心）
    # - mse     # 如需数值稳定性，可开启
    # - mae

  # ----------------------------------
  # Snapshot
  # ----------------------------------
  snapshot_enabled: false
  snapshot_every_n_steps: 1

  # ----------------------------------
  # Dataset schema (FROZEN)
  # ----------------------------------
  dataset:
    feature_columns:
      - open
      - high
      - low
      - close
      - volume
      - notional
      - trade_count
      - symbol
      - l0_amount
      - l0_avg_trade_size
      - l0_range
      - l0_abs_move
      - l0_log_volume
      - l0_log_trade_count
      - l1_std_w20_abs_move
      - l1_ret_w20_1
      - l1_z_w20_l0_log_trade_count
      - l1_z_w20_l1_std_w20_abs_move

    label_column: "label_fwd_ret_s5"
    drop_na: true


# ==================================================
# Label definition (DECLARATIVE / OPTIONAL)
# ==================================================
# label:
#   type: forward_return
#   forward_return:
#     horizon: 5
#     price_col: close
#     use_log_return: false
